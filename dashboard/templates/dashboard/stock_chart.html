<!DOCTYPE html>
{% load static %}
<link rel="stylesheet" href="{% static 'dashboard/styles.css' %}">
<html>
<head>
    <title>Dashboard Financiero</title>

</head>
<body>

    <h1>Gráfico de Acción</h1>

    <form method="get" id="stock-form">
        <label for="ticker">Ticker:</label>
        <input type="text" name="ticker" value="{{ ticker }}" placeholder="Ej: AAPL, TSLA, MELI" required>
        
        <label for="period">Periodo:</label>
        <select name="period" onchange="document.getElementById('stock-form').submit();">
            <option value="1d" {% if timeframe == "1d" %}selected{% endif %}>1 Día</option>
            <option value="1wk" {% if timeframe == "1wk" %}selected{% endif %}>1 Semana</option>
            <option value="1mo" {% if timeframe == "1mo" %}selected{% endif %}>1 Mes</option>
            <option value="1y" {% if timeframe == "1y" %}selected{% endif %}>1 Año</option>
        </select>
    </form>

    <h2><strong>Grafico de:</strong> {{ company_name }}</h2>
    

    <div class="chart-container" style="height: 500px; width: 100%;">
    <!-- Widget de TradingView -->
    <div id="tradingview-widget" style="width: 100%; height: 100%;"></div>

    <!-- Primero cargás la librería -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <!-- Luego, instanciás el widget -->
    <script type="text/javascript">
        new TradingView.widget({
            "container_id": "tradingview-widget",
            "autosize": true,
            "symbol": "NASDAQ:{{ ticker }}",
            "interval": "{{ interval }}",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "es",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "save_image": false,
            "hide_side_toolbar": false,
            "show_popup_button": true,
            "popup_width": "1020",
            "popup_height": "500"
        });
    </script>

</div>
<h2><strong>Ultimas noticias:</strong> {{ company_name }}</h2>
    <ul>
    {% for item in news %}
    <li>
      <a href="{{ item.link }}" target="_blank">{{ item.title }}</a>
      <small>{{ item.published }}</small>
    </li>
  {% empty %}
    <li>No hay noticias disponibles.</li>
  {% endfor %}
</ul>


</body>
</html>